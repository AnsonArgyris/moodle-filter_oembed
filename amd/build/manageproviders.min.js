define(["jquery","core/notification","core/ajax","core/templates","core/fragment","filter_oembed/list"],function(a,b,c,d,e,f){return{prevEditRow:null,listenEnableDisable:function(){a("#oembedproviders").on("click",".oembed-provider-actions .filter-oembed-visibility",function(e){e.preventDefault();var f=a(this).parents("tr")[0],g=a(f).data("pid"),h=!a(f).hasClass("dimmed_text"),i=h?"disable":"enable";c.call([{methodname:"filter_oembed_provider_manage_visibility",args:{pid:g,action:i},done:function(b){d.render("filter_oembed/managementpagerow",b.providermodel).done(function(b){a(f).replaceWith(b)})},fail:function(a){b.exception(a)}}],!0,!0)})},listenEdit:function(){var b=this,c=function(b,c){var f,g=new RegExp("(?:course-)(\\S)"),h=g.exec(a("body").attr("class")),i=parseInt(h[1]);f=c?{formdata:c,pid:b}:{pid:b},e.loadFragment("filter_oembed","provider",i,f).done(function(c,e){a("#oembed-display-providers_"+b).addClass("oembed-provider-editing"),d.replaceNodeContents(a("#oembed-display-providers_"+b+" .oembed-provider-details"),c,e)})};a("#oembedproviders").on("click",".oembed-provider-actions .filter-oembed-edit",function(d){d.preventDefault();var e=a(this).parents("tr")[0],f=a(e).data("pid");null!==b.prevEditRow&&(a(b.prevEditRow).removeClass("oembed-provider-editing"),a(b.prevEditRow).remove("form")),b.prevEditRow=e,c(f)}),a("#oembedproviders").on("click",".oembed-provider-details form #id_submitbutton",function(b){b.preventDefault();var d=a(this).parents("tr")[0],e=a(d).data("pid"),f=a(this).parents("form")[0];a(f).trigger("save-form-state");var g=a(f).serialize();c(e,g)}),a("#oembedproviders").on("click",".oembed-provider-details form #id_cancel",function(b){b.preventDefault();var c=a(this).parents("tr")[0];a(c).removeClass("oembed-provider-editing")})},init:function(){var a={valueNames:["list-providername"]};new f("providermanagement",a),this.listenEnableDisable(),this.listenEdit()}}});