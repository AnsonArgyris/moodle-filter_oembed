define(["jquery","core/notification","core/ajax","core/templates","core/fragment","filter_oembed/list"],function(a,b,c,d,e,f){return{prevEditRow:null,reloadRow:function(e,f,g,h){g=g?g:"reload",c.call([{methodname:"filter_oembed_provider_manage",args:{pid:e,action:g},done:function(b){d.render("filter_oembed/managementpagerow",b.providermodel).done(function(b){a(f).replaceWith(b),f=a("#oembed-display-providers_"+e),"function"==typeof h&&h(f)})},fail:function(a){b.exception(a)}}],!0,!0)},listenEnableDisable:function(){var b=this;a("#oembedproviders").on("click",".oembed-provider-actions .filter-oembed-visibility",function(c){c.preventDefault();var d=a(this).parents("tr")[0],e=a(d).data("pid"),f=!a(d).hasClass("dimmed_text"),g=f?"disable":"enable";b.reloadRow(e,d,g)})},listenEdit:function(){var b=this,c=function(b){a(b).removeClass("oembed-provider-editing"),a(b).remove("form"),a(b).remove(".alert")},f=function(b,c,f){var g,h=new RegExp("(?:course-)(\\S)"),i=h.exec(a("body").attr("class")),j=parseInt(i[1]);g=c?{formdata:c,pid:b}:{pid:b},e.loadFragment("filter_oembed","provider",j,g).done(function(c,e){a("#oembed-display-providers_"+b).addClass("oembed-provider-editing"),d.replaceNodeContents(a("#oembed-display-providers_"+b+" .oembed-provider-details"),c,e),"function"==typeof f&&f()})};a("#oembedproviders").on("click",".oembed-provider-actions .filter-oembed-edit",function(d){d.preventDefault();var e=a(this).parents("tr")[0],g=a(e).data("pid");null!==b.prevEditRow&&(c(b.prevEditRow),c(e)),b.prevEditRow=e,f(g)}),a("#oembedproviders").on("click",".oembed-provider-details form #id_submitbutton",function(d){d.preventDefault();var e=a(this).parents("tr")[0],g=a(e).data("pid"),h=a(this).parents("form")[0];a(h).trigger("save-form-state");var i=a(h).serialize();f(g,i,function(){var d="#oembed-display-providers_"+g+" .oembed-provider-details div.alert-success";if(a(d).length){var f=a(d)[0].outerHTML;c(e),b.reloadRow(g,e,"reload",function(){var b=a("#oembed-display-providers_"+g+" td");a(b).append(f)})}})}),a("#oembedproviders").on("click",".oembed-provider-details form #id_cancel",function(b){b.preventDefault();var d=a(this).parents("tr")[0];c(d)})},init:function(){var a={valueNames:["list-providername"]};new f("providermanagement",a),this.listenEnableDisable(),this.listenEdit()}}});